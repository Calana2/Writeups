Empezando, el programa esta empaquetado con UPX pero ofuscado:

### Intro
```
─$ xxd obfh-crackme.exe|head -n 30
00000000: 4d5a 9000 0300 0000 0400 0000 ffff 0000  MZ..............
00000010: b800 0000 0000 0000 4000 0000 0000 0000  ........@.......
00000020: 0000 0000 0000 0000 0000 0000 0000 0000  ................
00000030: 0000 0000 0000 0000 0000 0000 8000 0000  ................
00000040: 0e1f ba0e 00b4 09cd 21b8 014c cd21 6874  ........!..L.!ht
00000050: 7470 733a 2f2f 6769 7468 7562 2e63 6f6d  tps://github.com
00000060: 2f44 6f73 582d 6465 762f 5550 582d 5061  /DosX-dev/UPX-Pa
00000070: 7463 6865 720d 0d0a 2400 0000 0000 0000  tcher...$.......
00000080: 5045 0000 4c01 0300 0000 0000 0000 0000  PE..L...........
00000090: 0000 0000 e000 0f03 0b01 0600 0020 0000  ............. ..
000000a0: 0010 0000 00d0 0100 c0f5 0100 00e0 0100  ................
000000b0: 0000 0200 0000 4000 0010 0000 0002 0000  ......@.........
000000c0: 0400 0000 0000 0000 0400 0000 0000 0000  ................
000000d0: 0010 0200 0002 0000 0000 0000 0300 0000  ................
000000e0: 0000 1000 0010 0000 0000 1000 0010 0000  ................
000000f0: 0000 0000 1000 0000 0000 0000 0000 0000  ................
00000100: 0000 0200 b800 0000 0000 0000 0000 0000  ................
00000110: 0000 0000 0000 0000 0000 0000 0000 0000  ................
00000120: 0000 0000 0000 0000 0000 0000 0000 0000  ................
00000130: 0000 0000 0000 0000 0000 0000 0000 0000  ................
00000140: 0000 0000 0000 0000 0000 0000 0000 0000  ................
00000150: 0000 0000 0000 0000 0000 0000 0000 0000  ................
00000160: 0000 0000 0000 0000 0000 0000 0000 0000  ................
00000170: 0000 0000 0000 0000 2e64 6f73 7800 0000  .........dosx...
00000180: 00d0 0100 0010 0000 0000 0000 0002 0000  ................
00000190: 0000 0000 0000 0000 0000 0000 8000 00e0  ................
000001a0: 2e66 6973 6800 0000 0020 0000 00e0 0100  .fish.... ......
000001b0: 0018 0000 0002 0000 0000 0000 0000 0000  ................
000001c0: 0000 0000 4000 00e0 2e63 6f64 6500 0000  ....@....code...
000001d0: 0010 0000 0000 0200 0002 0000 001a 0000  ................
```

El DOS_STUB fue reemplazado con la URL del ofuscador: `https://github.com/DosX-dev/UPX-Patcher`.

Hace varias cosas. Pude revertir todas excepto una, que era reemplazar el numero magico "!UPX" y algunos bytes anteriores por bytes aleatorios.

Afortunadamente todos estos empaquetadores pueden ser derrotados por un depurador.

Hay que tener en cuenta que el programa usa tecnicas anti-debugging asi que debemos hacer que el depurador NO cambie a `1` el valor del campo `BeingDebugged` en el PEB.

En `x96dbg` podemos hacer esto yendo a "Depurar/Advanced/Ocultar el depurador (PEB)"  o usando el plugin ScyllaHide:

<img width="1024" height="768" alt="chall1" src="https://github.com/user-attachments/assets/5b117d81-3237-4a9d-8ddf-a7915cacca68" />
Nota: La foto muestra `x64dbg`, este programa especifico hay que depurarlo en `x32dbg`.

### Tail Jump
Los empaquetadores suelen tener algo que se llama "tail jump", que es un salto al final de la rutina que desempaca el programa hacia el Entry Point del programa real. En el mod grafico se ve mas claro.

<img width="1024" height="768" alt="chall2" src="https://github.com/user-attachments/assets/6d6c129e-ec96-4579-8424-358704b83811" />

Si seguimos los pasos perfectamente detallados en [este video](https://www.youtube.com/watch?v=guOcU-ZTL3A) obtenemos un binario desempaquetado bastante legible. Ahora podemos usar Ghidra para analizarlo estaticamente.

### Analisis estatico 

<img width="1235" height="148" alt="2025-08-08-182709_1235x148_scrot" src="https://github.com/user-attachments/assets/5fd1ed5b-ac3c-4564-b69c-e04ba1e65feb" />

<img width="445" height="244" alt="2025-08-08-182938_445x244_scrot" src="https://github.com/user-attachments/assets/5beca8fe-5392-41d4-abf2-d59d1ab8be40" />

En el stack frame de la funcion *FUN_0040248*, \[EBP - 0x24\](_Buf) contiene la entrada de usuario. Luego se hace un strncmp(_Buf,"FLAG{\0",5) y al final se comparan los elementos con indice 5,6,7,8,9,10,11 con los caracteres 'a','(','#','3','_','}','\0' respectivamente.

Contraseña: `FLAG{a(#3_}`

<img width="1024" height="768" alt="final" src="https://github.com/user-attachments/assets/acc49643-3aba-4621-9bcb-15103e51e157" />
